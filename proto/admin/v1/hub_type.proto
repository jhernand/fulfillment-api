//
// Copyright (c) 2025 Red Hat, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
// the License. You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
// an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
// specific language governing permissions and limitations under the License.
//

syntax = "proto3";

package admin.v1;

import "google/protobuf/timestamp.proto";
import "shared/v1/condition_status_type.proto";

// Contains the details of a hub.
message Hub {
  // Unique identifier of the hub.
  //
  // This will be automatically generated by the server when the hub is created.
  string id = 1;

  HubSpec spec = 2;
  HubStatus status = 3;
}

// Contains the details that the user provides to create a hub.
message HubSpec {
  // The Kubeconfig containing the address and credentials that the fulfillment service will use to connect to the hub.
  bytes kubeconfig = 1;

  // Namespace where the cluster orders will be created.
  string namespace = 2;
}

// Contains the current status of a hub.
message HubStatus {
  // Indicates the overall state of a hub.
  //
  // For more details check the conditions.
  HubState state = 1;

  // Contains a list of conditions that describe in detail the hub.
  //
  // For example, hub that has been disabled by the administrator would be represented like this (when converted to
  // JSON):
  //
  //    {
  //      "id": "123",
  //      "spec": {
  //        "kubeconfig": "..."
  //      },
  //      "state": "HUB_STATE_DISABLED",
  //      "status": {
  //        "conditions": [
  //          {
  //            "type: "HUB_CONDITION_TYPE_READY",
  //            "status": "CONDITION_STATUS_FALSE",
  //            "last_transition_time": "2025-03-12 20:15:59+00:00"
  //          },
  //          {
  //            "type": "HUB_CONDITION_TYPE_DISABLED",
  //            "status": "CONDITION_STATUS_FALSE",
  //            "last_transition_time": "2025-03-12 20:17:16+00:00",
  //            "reason": "Disabled",
  //            "message": "The management cluster has been disabled by the administrator"
  //          },
  //        ]
  //      }
  //    }
  //
  // In this example the `DISABLED` condition is true. That tells us that the hub has disabled by the administrator.
  repeated HubCondition conditions = 2;
}

// Represents the overall state of a hub.
enum HubState {
  // Unspecified indicates that the state isn't set.
  HUB_STATE_UNSPECIFIED = 0;

  // Unspecified indicates that the hub is ready.
  HUB_STATE_READY = 1;

  // Indicates that hub has been disabled by the administrator.
  HUB_STATE_DISABLED = 2;
}

// Contains the details of a condition that describes the status of a hub.
message HubCondition {
  // Indicates the type of condition.
  HubConditionType type = 1;

  // Indicates status of the condition.
  shared.v1.ConditionStatus status = 2;

  // This time is the last time that the condition was updated.
  google.protobuf.Timestamp last_transition_time = 3;

  // Contains a the reason of the condition in a format suitable for use by programs.
  //
  // The possible are documented in the `HubConditionType` object.
  optional string reason = 4;

  // Contains a text giving more details of the condition. This will usually be progress reports, or error messages, and
  // are intended for use by humans, to debug problems.
  optional string message = 5;
}

// Types of conditions used to describe a hub.
enum HubConditionType {
  // Unspecified indicates that the condition unknown.
  //
  // This will never be appear in the `spec.conditions` field of a management cluster.
  HUB_CONDITION_TYPE_UNSPECIFIED = 0;

  // Accepted indicates that the management cluster is ready.
  HUB_CONDITION_TYPE_READY = 1;

  // Rejected indicates that the management cluster has been disabled by the administrator.
  HUB_CONDITION_TYPE_DISABLED = 2;
}
